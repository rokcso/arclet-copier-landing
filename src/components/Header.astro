---
import { t, type Language } from "../i18n/utils";

export interface Props {
    lang: Language;
}

const { lang } = Astro.props;
const translate = t(lang);

// 获取当前路径并构建对应语言的URL
const currentPath = Astro.url.pathname;
let enUrl = "/";
let zhUrl = "/zh";

if (currentPath.startsWith("/zh/")) {
    // 当前在中文页面
    const subPath = currentPath.replace("/zh", "");
    enUrl = subPath === "/" ? "/" : subPath;
    zhUrl = currentPath;
} else if (currentPath === "/zh") {
    // 中文首页
    enUrl = "/";
    zhUrl = "/zh";
} else if (currentPath === "/") {
    // 英文首页
    enUrl = "/";
    zhUrl = "/zh";
} else {
    // 其他英文页面
    enUrl = currentPath;
    zhUrl = "/zh" + currentPath;
}
---

<style>
    .logo-rotate:hover {
        transform: rotate(-360deg);
    }
</style>

<header
    class="fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-sm border-b border-secondary-200"
>
    <div class="max-w-6xl mx-auto px-6 py-4">
        <nav class="flex items-center justify-between">
            <!-- Logo -->
            <a
                href={lang === "zh" ? "/zh" : "/"}
                class="flex items-center space-x-3 hover:opacity-80 transition-opacity duration-200"
            >
                <img
                    src="/favicon.svg"
                    alt="Arclet Copier Favicon"
                    class="w-8 h-8 transition-transform duration-500 logo-rotate"
                />
                <img
                    src="/img/logo.webp"
                    alt="Arclet Copier"
                    class="w-8 h-8 transition-transform duration-500 logo-rotate"
                />
                <span
                    class="font-serif font-semibold text-xl text-secondary-900"
                    >Arclet Copier</span
                >
            </a>

            <!-- Right Side: Navigation Links & Language Switcher -->
            <div class="flex items-center space-x-6">
                <!-- Navigation Links -->
                <div class="hidden md:flex items-center space-x-6">
                    <a
                        href={lang === "zh" ? "/zh#features" : "/#features"}
                        class="text-secondary-600 hover:text-primary-600 transition-colors duration-200 font-medium"
                    >
                        {translate("nav.features")}
                    </a>
                    <a
                        href={lang === "zh" ? "/zh#download" : "/#download"}
                        class="text-secondary-600 hover:text-primary-600 transition-colors duration-200 font-medium"
                    >
                        {translate("nav.download")}
                    </a>
                </div>

                <div
                    class="flex items-center space-x-2 bg-secondary-100 rounded-lg p-1"
                >
                    <a
                        href={enUrl}
                        class={`px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 ${lang === "en" ? "bg-white text-primary-600 shadow-soft" : "text-secondary-600 hover:text-secondary-800"}`}
                    >
                        EN
                    </a>
                    <a
                        href={zhUrl}
                        class={`px-3 py-1 rounded-md text-sm font-medium transition-all duration-200 ${lang === "zh" ? "bg-white text-primary-600 shadow-soft" : "text-secondary-600 hover:text-secondary-800"}`}
                    >
                        中文
                    </a>
                </div>

                <!-- Mobile Menu Button -->
                <button
                    class="md:hidden p-2 text-secondary-600 hover:text-secondary-800"
                    id="mobile-menu-btn"
                >
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div
            class="md:hidden mt-4 pb-4 border-t border-secondary-200 hidden"
            id="mobile-menu"
        >
            <div class="flex flex-col space-y-3 pt-4">
                <a
                    href="#features"
                    class="text-secondary-600 hover:text-primary-600 transition-colors duration-200 font-medium"
                >
                    {translate("nav.features")}
                </a>
                <a
                    href="#download"
                    class="text-secondary-600 hover:text-primary-600 transition-colors duration-200 font-medium"
                >
                    {translate("nav.download")}
                </a>
            </div>
        </div>
    </div>
</header>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const mobileMenuBtn = document.getElementById("mobile-menu-btn");
        const mobileMenu = document.getElementById("mobile-menu");

        mobileMenuBtn?.addEventListener("click", () => {
            mobileMenu?.classList.toggle("hidden");
        });
    });
</script>
