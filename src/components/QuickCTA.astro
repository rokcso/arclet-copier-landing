---
import { t, type Language } from '../i18n/utils';

export interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const translate = t(lang);
---

<section class="pb-16 bg-white">
  <div class="max-w-4xl mx-auto px-6 text-center">
    <a
      id="quick-cta-link"
      href="https://chromewebstore.google.com/detail/mkflehheaokdfopijachhfdbofkppdil"
      target="_blank"
      data-edge-text={translate('quickCta.edge')}
      class="inline-flex items-center gap-2 px-5 py-2.5 bg-white text-primary-600 font-medium text-sm border-2 border-primary-600 rounded-lg shadow-soft hover:bg-primary-600 hover:text-white hover:shadow-soft-md transition-all duration-300 group"
      onclick={`if (typeof umami !== 'undefined') { umami.track('download_click', { store: 'chrome', language: '${lang}', source: 'screenshots' }); }`}
    >
      <span id="quick-cta-text">{translate('quickCta.chrome')}</span>
      <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 5l7 7-7 7"
        ></path>
      </svg>
    </a>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const ctaLink = document.getElementById('quick-cta-link') as HTMLAnchorElement | null;
    const ctaText = document.getElementById('quick-cta-text');

    if (!ctaLink || !ctaText) return;

    // Detect browser
    const userAgent = navigator.userAgent.toLowerCase();
    const isEdge = userAgent.includes('edg/');

    // Store URLs
    const edgeStoreUrl = 'https://microsoftedge.microsoft.com/addons/detail/flcemgbijffbmbgcmabmmjhankbegdgm';

    // Get current language from HTML lang attribute
    const currentLang = document.documentElement.lang || 'en';

    // Update link and text based on browser
    if (isEdge) {
      ctaLink.href = edgeStoreUrl;

      // Get Edge text from data attribute set by server
      const edgeText = ctaLink.getAttribute('data-edge-text');
      if (edgeText) {
        ctaText.textContent = edgeText;
      }

      // Update analytics tracking
      ctaLink.setAttribute('onclick',
        `if (typeof umami !== 'undefined') { umami.track('download_click', { store: 'edge', language: '${currentLang}', source: 'screenshots' }); }`
      );
    }
  });
</script>
